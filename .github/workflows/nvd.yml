name: lint

on: [push, pull_request]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Cache m2 repo
      uses: actions/cache@v2
      env:
        cache-name: cache-m2-repo
      with:
        # npm cache files are stored in `~/.npm` on Linux/macOS
        path: ~/.m2
        key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/deps.edn') }}
        restore-keys: |
          ${{ runner.os }}-build-${{ env.cache-name }}-
          ${{ runner.os }}-build-
          ${{ runner.os }}-
    - name: setup clojure
      uses: DeLaGuardo/setup-clojure@2.0
      with:
        tools-deps: '1.10.1.510'
    - name: run nvd
      run: clojure -Sdeps '{:deps {clj-nvd {:git/url "https://github.com/miikka/clj-nvd.git" :sha "141d54f5304e53f6caa6e3de1677f3cfb04091f4"}}}' -m clj-nvd.core check
      working-directory: app/backend/
    - uses: ashley-taylor/junit-report-annotations-action@v1.1
      if: always()
      with:
        path: app/backend/target/nvd/dependency-check-junit.xml
        access-token: ${{ secrets.GITHUB_TOKEN }}
